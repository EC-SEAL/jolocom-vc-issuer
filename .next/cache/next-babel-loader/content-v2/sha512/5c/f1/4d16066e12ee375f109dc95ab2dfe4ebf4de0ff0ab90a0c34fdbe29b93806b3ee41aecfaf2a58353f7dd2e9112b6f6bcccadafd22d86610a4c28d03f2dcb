{"ast":null,"code":"import _regeneratorRuntime from \"/home/ni/code/js/seal-issuer/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/ni/code/js/seal-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/ni/code/js/seal-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/ni/code/js/seal-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/home/ni/code/js/seal-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/home/ni/code/js/seal-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/ni/code/js/seal-issuer/node_modules/next/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from \"react\";\nimport { setSessionData, addToSelection, addSetToSelection, setStepperSteps, setEndpoint, setBaseUrl } from \"../store\";\nimport Layout from \"../components/Layout\";\nimport { connect } from \"react-redux\";\nimport Link from \"next/link\";\nimport { Button, Row, Col, Card, Container } from \"react-bootstrap\";\nimport MyStepper from \"../components/Stepper\";\n\nvar uuidv1 = require(\"uuid/v1\");\n\nvar IssueEidas = /*#__PURE__*/function (_React$Component) {\n  _inherits(IssueEidas, _React$Component);\n\n  var _super = _createSuper(IssueEidas);\n\n  function IssueEidas(props) {\n    var _this;\n\n    _classCallCheck(this, IssueEidas);\n\n    _this = _super.call(this, props);\n    _this.dispatch = props.dispatch;\n    _this.isFetching = props.isFetching;\n    _this.sessionData = props.sessionData;\n    return _this;\n  }\n\n  _createClass(IssueEidas, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.props.setSteps([{\n        title: 'Authenticate over \"eIDAS-eID\"'\n      }, {\n        title: 'Authenticate over \"Academic Id\"'\n      }, {\n        title: \"Request Issuance\"\n      }, {\n        title: \"Accept Verifiable Credential\"\n      }]);\n\n      if (this.props.sessionData && this.props.sessionData.eidas && this.props.sessionData.fullAcademicId) {\n        var toSelect = [this.props.sessionData.eidas, this.props.sessionData.fullAcademicId];\n        this.props.setSetsToSelection(toSelect);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var hasEidasRequiredAttr = this.props.sessionData !== null && this.props.sessionData !== undefined && this.props.sessionData.eidas !== undefined;\n      var eIDASLoginButton = !hasEidasRequiredAttr ? __jsx(\"a\", {\n        className: \"btn btn-primary\",\n        href: \"/test/academicId-eidas-authenticate\",\n        role: \"button\"\n      }, \"eIDAS\") : __jsx(Button, {\n        variant: \"primary\",\n        disabled: true,\n        style: {\n          backgroundColor: \"#00c642\"\n        }\n      }, \"eIDAS\");\n      var hasAcademicIdRequiredAttr = this.props.sessionData !== null && this.props.sessionData !== undefined && this.props.sessionData.academicId !== undefined;\n      var token = uuidv1();\n      var academicIdButton = !hasAcademicIdRequiredAttr && hasEidasRequiredAttr ? __jsx(\"a\", {\n        className: \"btn btn-primary\",\n        href: \"/academic-id-check/query?sessionId=full-\".concat(token),\n        role: \"button\"\n      }, \"AcademicId\") : hasAcademicIdRequiredAttr ? __jsx(Button, {\n        variant: \"primary\",\n        disabled: true,\n        style: {\n          backgroundColor: \"#00c642\"\n        }\n      }, \"AcademicId\") : __jsx(Button, {\n        variant: \"primary\",\n        disabled: true\n      }, \"AcademicId\");\n      var vcIssuanceLink = \"/issue/SEAL-ACADEMICID\";\n      var vcIssuanceHref = \"/issue/[vcType]\"; // console.log(\n      //   `issue-gr-academic-id.js - render:: vcIssanceLink ${vcIssuanceLink}`\n      // );\n\n      var credentialCard = __jsx(Card, {\n        className: \"text-center\",\n        style: {\n          marginTop: \"2rem\"\n        }\n      }, __jsx(Card.Header, null, \"Issue a Verifiable Credential linking your eIDAS eID with your Greek Academic Attributes\"), __jsx(Card.Body, null, __jsx(Card.Title, null, hasEidasRequiredAttr && hasAcademicIdRequiredAttr ? \"Credentials Issuance is ready!\" : \"Please authenticate to the required data sources\"), __jsx(Card.Text, null, \"Once you have authenticated through the required data sources, click the \\\"Issue\\\" button to generate and receive your VC .\"), __jsx(Container, null, __jsx(Row, null, __jsx(Col, null, eIDASLoginButton), __jsx(Col, null, academicIdButton), __jsx(Col, null, __jsx(Link, {\n        as: vcIssuanceLink,\n        href: vcIssuanceHref\n      }, __jsx(Button, {\n        variant: \"primary\",\n        disabled: !(hasAcademicIdRequiredAttr && hasEidasRequiredAttr)\n      }, \"Issue Verifiable Claim\")))))));\n\n      var stepNumber = 0;\n\n      if (hasEidasRequiredAttr) {\n        if (!hasAcademicIdRequiredAttr) {\n          stepNumber = 1;\n        } else {\n          stepNumber = 2;\n        }\n      } //icon:'/eduGAIN-icon.png'\n\n\n      var stepperSteps = [{\n        title: 'Authenticate over \"eIDAS-eID\"'\n      }, {\n        title: 'Authenticate over \"GR-AcademicId\"'\n      }, {\n        title: \"Request Issuance\"\n      }, {\n        title: \"Accept Verifiable Credential\"\n      }];\n      return __jsx(Layout, null, __jsx(Row, null, __jsx(Col, null, __jsx(MyStepper, {\n        steps: stepperSteps,\n        activeNum: stepNumber,\n        completeTitleColor: \"#00c642\" // completeColor={\"#00c642\"}\n\n      }))), credentialCard, __jsx(Row, null, __jsx(\"div\", {\n        className: \"col\",\n        style: {\n          marginTop: \"1.5rem\"\n        }\n      }, __jsx(Link, {\n        href: this.props.baseUrl ? \"\".concat(this.props.baseUrl) : \"/\"\n      }, __jsx(Button, {\n        variant: \"primary\",\n        className: \"float-right\"\n      }, \"Home\")))));\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref) {\n        var reduxStore, req, userSessionData, baseUrl;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                reduxStore = _ref.reduxStore, req = _ref.req;\n\n                if (false) {\n                  userSessionData = req.session.userData;\n                  reduxStore.dispatch(setEndpoint(req.session.enpoint));\n                  baseUrl = req.session.baseUrl ? \"/\".concat(req.session.baseUrl, \"/\") : \"\";\n                  reduxStore.dispatch(setBaseUrl(baseUrl));\n                } else {\n                  if (reduxStore.getState().sessionData) {\n                    userSessionData = reduxStore.getState().sessionData;\n                  } else {\n                    console.log(\"no server session data found\");\n                  }\n                }\n\n                if (userSessionData) {\n                  reduxStore.dispatch(setSessionData(userSessionData));\n                } //returned value here is getting mered with the mapstatetoprops\n                // mapstatetoprops overrides these values if they match\n\n\n                return _context.abrupt(\"return\", {\n                  sessionData: userSessionData,\n                  qrData: reduxStore.getState().qrData\n                });\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function getInitialProps(_x) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  return IssueEidas;\n}(React.Component);\n\nfunction mapStateToProps(state) {\n  return {\n    isFetching: state.fetching,\n    qrData: state.qrData,\n    sessionData: state.sessionData,\n    userSelection: state.userSelection,\n    // the attributes selected by the user to be included in a VC\n    baseUrl: state.baseUrl\n  };\n}\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    setSetsToSelection: function setSetsToSelection(set) {\n      dispatch(addSetToSelection(set));\n    },\n    setSteps: function setSteps(steps) {\n      dispatch(setStepperSteps(steps));\n    },\n    setEndPoint: function setEndPoint(endpont) {\n      dispatch(setEndpoint(endpoint));\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(IssueEidas);","map":null,"metadata":{},"sourceType":"module"}